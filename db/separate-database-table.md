### 分库分表
#### 单台数据库服务器的存储能力会成为系统的瓶颈
- 数据量太大，读写的性能会下降，即使有索引，索引也会变得很大，性能同样会下降
- 数据文件会变得很大，数据库备份和恢复需要耗费很长时间
- 数据文件越大，极端情况下丢失数据的风险越高（例如，机房火灾导致数据库主备机都发生故障）

#### 业务分库
业务分库指的是按照业务模块将数据分散到不同的数据库服务器

问题:
- join 操作问题
  - 业务分库后，原本在同一个数据库中的表分散到不同数据库中，导致无法使用
- 事务问题
  - 原本在同一个数据库中不同的表可以在同一个事务中修改，业务分库后，表分散到不同的数据库中，无法通过事务统一修改
- 成本问题

#### 分表
- 将不同业务数据分散存储到不同的数据库服务器，能够支撑百万甚至千万用户规模的业务，
- 但如果业务继续发展，同一业务的单表数据也会达到单台数据库服务器的处理瓶颈
- 单表数据拆分有两种方式：垂直分表和水平分表

##### 分表能够有效地分散存储压力和带来性能提升，但和分库一样，也会引入各种复杂性
- 垂直分表，垂直分表适合将表中某些不常用且占了大量空间的列拆分出去
- 水平分表，水平分表适合表行数特别大的表，有的公司要求单表行数超过 5000 万就必须进行分表，这个数字可以作为参考，但并不是绝对标准，关键还是要看表的访问性能
  - 路由，水平分表后，某条数据具体属于哪个切分后的子表，需要增加路由算法进行计算，这个算法会引入一定的复杂性
    - 范围路由：选取有序的数据列（例如，整形、时间戳等）作为路由的条件，不同分段分散到不同的数据库表中
    - Hash 路由：选取某个列（或者某几个列组合也可以）的值进行 Hash 运算，然后根据 Hash 结果分散到不同的数据库表中
    - 配置路由：配置路由就是路由表，用一张独立的表来记录路由信息
  - join 操作
    - 水平分表后，数据分散在多个表中，如果需要与其他表进行 join 查询，需要在业务代码或者数据库中间件中进行多次 join 查询，然后将结果合并
  - count() 操作
    - 水平分表后，虽然物理上数据分散到多个表中，但某些业务逻辑上还是会将这些表当作一个表来处理
  - order by 操作
    - 水平分表后，数据分散到多个子表中，排序操作无法在数据库中完成，只能由业务代码或者数据库中间件分别查询每个子表中的数据，然后汇总进行排序

#### 实现方法
和数据库读写分离类似，分库分表具体的实现方式也是 "程序代码封装" 和 "中间件封装"
