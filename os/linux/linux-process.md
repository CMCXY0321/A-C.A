### C/C++语言编写, 四个步骤
- 预处理（Preprocessing）
- 编译（Compilation）
- 汇编（Assembly）
- 链接（Linking）

### GCC 工具链介绍
通常所说的GCC是GUN Compiler Collection的简称，是Linux系统上常用的编译工具。GCC工具链软件包括GCC、Binutils、C运行库

### Binutils
一组二进制程序处理工具，包括：addr2line、ar、objcopy、objdump、as、ld、ldd、readelf、size等
- addr2line：用来将程序地址转换成其所对应的程序源文件及所对应的代码行，也可以得到所对应的函数。该工具将帮助调试器在调试的过程中定位对应的源代码位置。
- as：主要用于汇编，有关汇编的详细介绍请参见后文。
- ld：主要用于链接，有关链接的详细介绍请参见后文。
- ar：主要用于创建静态库。为了便于初学者理解，在此介绍动态库与静态库的概念：

如果要将多个.o目标文件生成一个库文件，则存在两种类型的库，一种是静态库，另一种是动态库
在windows中静态库是以 .lib 为后缀的文件，共享库是以 .dll 为后缀的文件。在linux中静态库是以.a为后缀的文件，共享库是以.so为后缀的文件
静态库和动态库的不同点在于代码被载入的时刻不同。静态库的代码在编译过程中已经被载入可执行程序，因此体积较大。共享库的代码是在可执行程序运行时才载入内存的，在编译过程中仅简单的引用，因此代码体积较小。在Linux系统中，可以用ldd命令查看一个可执行程序依赖的共享库
如果一个系统中存在多个需要同时运行的程序且这些程序之间存在共享库，那么采用动态库的形式将更节省内存。

- ldd：可以用于查看一个可执行程序依赖的共享库
- objcopy：将一种对象文件翻译成另一种格式，譬如将.bin转换成.elf、或者将.elf转换成.bin等
- objdump：主要的作用是反汇编。有关反汇编的详细介绍，请参见后文
- readelf：显示有关ELF文件的信息，请参见后文了解更多信息
- size：列出可执行文件每个部分的尺寸和总尺寸，代码段、数据段、总大小等，请参见后文了解使用size的具体使用实例

### C运行库
C语言标准主要由两部分组成：
- 一部分描述C的语法，另一部分描述C标准库
- C标准库定义了一组标准头文件，每个头文件中包含一些相关的函数、变量、类型声明和宏定义，譬如常见的printf函数便是一个C标准库函数，其原型定义在stdio头文件中

#### C语言标准仅仅定义了C标准库函数原型，并没有提供实现。因此，C语言编译器通常需要一个C运行时库（C Run Time Libray，CRT）的支持
### 准备工作
由于GCC工具链主要是在Linux环境中进行使用，因此本文也将以Linux系统作为工作环境

### 编译过程
- 预处理
  - 将所有的#define删除，并且展开所有的宏定义，并且处理所有的条件预编译指令，比如#if #ifdef #elif #else #endif等
  - 处理#include预编译指令，将被包含的文件插入到该预编译指令的位置
  - 删除所有注释“//”和“/* */”
  - 添加行号和文件标识，以便编译时产生调试用的行号及编译错误警告行号
  - 保留所有的#pragma编译器指令，后续编译过程需要使用它们
- 编译
  - 编译过程就是对预处理完的文件进行一系列的词法分析，语法分析，语义分析及优化后生成相应的汇编代码
- 汇编
  - 汇编过程调用对汇编代码进行处理，生成处理器能识别的指令，保存在后缀为.o的目标文件中
- 链接
  - 静态链接是指在编译阶段直接把静态库加入到可执行文件中去，这样可执行文件会比较大
  - 动态链接则是指链接阶段仅仅只加入一些描述信息，而程序执行时再从系统中把相应动态库加载到内存中去
    - 在Linux系统中，gcc编译链接时的动态库搜索路径的顺序通常为：首先从gcc命令的参数-L指定的路径寻找；再从环境变量LIBRARY_PATH指定的路径寻址；再从默认路径/lib、/usr/lib、/usr/local/lib寻找
    - 在Linux系统中，执行二进制文件时的动态库搜索路径的顺序通常为：首先搜索编译目标代码时指定的动态库搜索路径；再从环境变量LD_LIBRARY_PATH指定的路径寻址；再从配置文件/etc/ld.so.conf中指定的动态库搜索路径；再从默认路径/lib、/usr/lib寻找
    - 在Linux系统中，可以用ldd命令查看一个可执行程序依赖的共享库

### 分析ELF文件
- 一个典型的ELF文件包含下面几个段
- .text：已编译程序的指令代码段
  - .rodata：ro代表read only，即只读数据（譬如常数const）
  - .data：已初始化的C程序全局变量和静态局部变量
  - .bss：未初始化的C程序全局变量和静态局部变量
  - .debug：调试符号表，调试器用此段的信息帮助调试

### 反汇编ELF
- 由于ELF文件无法被当做普通文本文件打开，如果希望直接查看一个ELF文件包含的指令和数据，需要使用反汇编的方法

### 反汇编ELF
由于ELF文件无法被当做普通文本文件打开，如果希望直接查看一个ELF文件包含的指令和数据，需要使用反汇编的方法
